<!-- index.html: Place in your repo root, acts as a redirect to index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>üéôÔ∏è Live Vertaler</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 40px; }
    button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    input[type="checkbox"] { transform: scale(1.5); margin: 10px; }
    p { font-size: 18px; }
  </style>
</head>
<body>
  <h1>üéôÔ∏è Live Vertaler</h1>
  <p>Gebruik je microfoon om te spreken. De tekst wordt herkend, vertaald en (optioneel) uitgesproken.</p>

  <div>
    <label for="textOnly">
      <input type="checkbox" id="textOnly"> Enkel tekstmodus (geen stem)
    </label>
  </div>

  <label for="languageSelect">Kies doeltaal:</label>
  <select id="languageSelect">
    <option value="fr">French</option>
  <option value="nl">Dutch</option>
  <option value="en-CA">English (Canada)</option>
  <option value="es">Spanish</option>
  <option value="pt">Portuguese</option>
  <option value="lg">Luganda</option>
  <option value="fi">Finnish</option>
  <option value="kg">Kituba/Kikongo</option>
  <option value="lua">Tshiluba</option>
  <option value="sw">Swahili</option>
  <option value="sv">Swedish</option>
  <option value="bci">Balou√©</option>
  <option value="hi">Hindi</option>
  <option value="no">Norwegian</option>
  <option value="de">German</option>
  <option value="ms">Malay</option>
  <option value="am">Amharic</option>
  <option value="id">Indonesian</option>
  <option value="mg">Malagasy</option>
  <option value="ar">Arabic</option>
  <option value="ru">Russian</option>
  <option value="zh-CN">Chinese (Simplified)</option>
  <option value="tr">Turkish</option>
  <option value="pl">Polish</option>
  <option value="ja">Japanese</option>
  </select>

  <label for="sourceLanguage">Kies brontaal:</label>
  <select id="sourceLanguage">
    <option value="fr">French</option>
  <option value="nl">Dutch</option>
  <option value="en-CA">English (Canada)</option>
  <option value="es">Spanish</option>
  <option value="pt">Portuguese</option>
  <option value="lg">Luganda</option>
  <option value="fi">Finnish</option>
  <option value="kg">Kituba/Kikongo</option>
  <option value="lua">Tshiluba</option>
  <option value="sw">Swahili</option>
  <option value="sv">Swedish</option>
  <option value="bci">Balou√©</option>
  <option value="hi">Hindi</option>
  <option value="no">Norwegian</option>
  <option value="de">German</option>
  <option value="ms">Malay</option>
  <option value="am">Amharic</option>
  <option value="id">Indonesian</option>
  <option value="mg">Malagasy</option>
  <option value="ar">Arabic</option>
  <option value="ru">Russian</option>
  <option value="zh-CN">Chinese (Simplified)</option>
  <option value="tr">Turkish</option>
  <option value="pl">Polish</option>
  <option value="ja">Japanese</option>
  </select>

  <br>
  <button id="start">üé§ Start opname</button>
  <button id="pause" disabled>‚è∏Ô∏è Pauze</button>
  <button id="stop" disabled>‚èπÔ∏è Stop</button>

  <p><b>Origineel:</b> <span id="orig"></span></p>
  <p><b>Vertaling:</b> <span id="trans"></span></p>

  <script>
    let mediaRecorder, chunks = [];
    let isPaused = false, isSpeaking = false;
    let audioContext, analyser, source;
    let intervalId;

    async function setupAudioDetection(stream) {
      audioContext = new AudioContext();
      source = audioContext.createMediaStreamSource(stream);
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 512;
      source.connect(analyser);

      const dataArray = new Uint8Array(analyser.frequencyBinCount);

      function detectSpeech() {
        analyser.getByteFrequencyData(dataArray);
        const volume = dataArray.reduce((a, b) => a + b) / dataArray.length;
        isSpeaking = volume > 10;
      }

      intervalId = setInterval(detectSpeech, 200);
    }

    document.getElementById("start").onclick = async () => {
      try {
        if (location.protocol !== "https:") {
          alert("‚ö†Ô∏è Deze app vereist HTTPS om de microfoon te gebruiken.");
          return;
        }

        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        await setupAudioDetection(stream);

        mediaRecorder = new MediaRecorder(stream);
        chunks = [];
        isPaused = false;

        mediaRecorder.ondataavailable = e => {
          chunks.push(e.data);
        };

        mediaRecorder.onstop = async () => {
          if (chunks.length === 0) return;
          const blob = new Blob(chunks, { type: "audio/wav" });
          chunks = [];

          const formData = new FormData();
          formData.append("audio", blob, "chunk.wav");
          formData.append("from", document.getElementById("sourceLanguage").value);
          formData.append("to", document.getElementById("languageSelect").value);
          formData.append("textOnly", document.getElementById("textOnly").checked ? "true" : "false");

          try {
            const response = await fetch("/api/translate", { method: "POST", body: formData });
            const data = await response.json();
            document.getElementById("orig").innerText = data.original || "(geen tekst)";
            document.getElementById("trans").innerText = data.translation || "(geen vertaling)";
          } catch (error) {
            console.error("Fout bij vertalen:", error);
            alert("Fout bij vertalen: " + error.message);
          }
        };

        setInterval(() => {
          if (!isPaused && isSpeaking && mediaRecorder.state === "inactive") {
            mediaRecorder.start();
            setTimeout(() => {
              if (mediaRecorder.state === "recording") {
                mediaRecorder.stop();
              }
            }, 5000);
          }
        }, 1000);

        document.getElementById("start").disabled = true;
        document.getElementById("pause").disabled = false;
        document.getElementById("stop").disabled = false;

      } catch (err) {
        alert("Microfoon werkt niet: " + err.message);
        console.error("Microfoonfout:", err);
      }
    };

    document.getElementById("pause").onclick = () => {
      if (!mediaRecorder) return;

      if (!isPaused && mediaRecorder.state === "recording") {
        mediaRecorder.pause();
        isPaused = true;
        document.getElementById("pause").innerText = "‚ñ∂Ô∏è Hervat";
      } else if (isPaused && mediaRecorder.state === "paused") {
        mediaRecorder.resume();
        isPaused = false;
        document.getElementById("pause").innerText = "‚è∏Ô∏è Pauze";
      }
    };

    document.getElementById("stop").onclick = () => {
      clearInterval(intervalId);
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
      }

      document.getElementById("start").disabled = false;
      document.getElementById("pause").disabled = true;
      document.getElementById("stop").disabled = true;
      document.getElementById("pause").innerText = "‚è∏Ô∏è Pauze";
      isPaused = false;

      const link = document.createElement("a");
      link.href = "/resultaat";
      link.download = "resultaat_vertaling.html";
      link.click();
    };
  </script>
</body>
</html>




